# MD Tasks - v0.2 要件定義書

## 概要

v0.1のMVP機能をベースに、UI操作を拡充してユーザビリティを向上させる。

---

## 機能一覧

### 1. UIからのソート切り替え

#### 概要

WebView UIからソート方式（sortBy）を切り替えられるようにする。

#### 仕様

- **UI配置**: ツールバーにドロップダウンを配置
- **選択肢**: `markdown`（元の順序）/ `priority`（優先度順）/ `due`（期限順）/ `alphabetical`（アルファベット順）
- **永続化**: フロントマターに保存
  - フロントマターに`sortBy`フィールドを追加
  - 優先順位: フロントマター > VSCode設定 > デフォルト値

#### フロントマター例

```yaml
---
statuses: [todo, in-progress, done]
sortBy: priority
---
```

---

### 2. パスによる絞込み

#### 概要

見出しパス（グルーピング）でタスクをフィルタリングできるようにする。特定のプロジェクトやカテゴリのタスクのみを表示可能にする。

#### 仕様

- **UI配置**: ツールバーにドロップダウンを配置
- **階層表示**: ドロップダウン内でパスを階層的にインデント表示
- **選択方式**: 複数選択可能（チェックボックス付きドロップダウン）
- **絞り込み動作**: 完全一致（選択したパス直下のタスクのみ表示）
- **永続化**: フロントマターに保存
  - フロントマターに`filterPaths`フィールドを追加（配列形式）
  - 未指定または空配列の場合は全パスを表示

#### UI表示イメージ

```
Path: [2 selected ▼]
      ☑ すべて表示
      ─────────────
      ☑ 仕事
      │   ☐ プロジェクトA
      │   ☐ プロジェクトB
      ☑ 個人
```

#### フロントマター例

```yaml
---
statuses: [todo, in-progress, done]
filterPaths:
  - 仕事
  - 個人
---
```

---

### 3. フォームからのpriority入力

#### 概要

タスク編集フォームにpriorityフィールドを追加する。

#### 仕様

- **入力方式**: ドロップダウン（4択固定）
- **選択肢**: `None`（未設定）/ `High` / `Medium` / `Low`
- **デフォルト値**: `None`
- **ソート時の扱い**: `None`は最後に表示（既存の`DEFAULT_PRIORITY_ORDER = 999`と整合）

#### UI配置

タスク編集フォーム内に「Metadata」セクションを設け、その中に配置する。将来のメタデータ拡張（startDate, endDate等）に備えた構成。

```
┌─────────────────────────────────┐
│ Title: [タスク名           ]    │
│ Status: [todo ▼]                │
├─────────────────────────────────┤
│ Metadata                        │
│   Priority: [None ▼]            │
│   Due:      [          ]        │  ← v0.2では読み取り専用または非表示
└─────────────────────────────────┘
```

#### Markdown表現

```markdown
- [ ] タスク名 @status(todo) @priority(high)
```

---

### 4. UIからのstatus管理

#### 概要

ボード上でステータス（カラム）の追加・編集・削除・並び替えができるようにする。変更はフロントマターに反映される。

#### インライン操作（カラム上で直接）

| 操作 | UI |
|-----|-----|
| **追加** | カラム末尾の「+」ボタン → ステータス名入力ポップオーバー |
| **リネーム** | カラムヘッダーの⋮メニュー → Rename |

#### 設定モーダル（ツールバーの⚙️ボタン）

詳細なステータス設定を行うモーダル。

| 設定項目 | 説明 |
|---------|------|
| **並び替え** | ドラッグ&ドロップでカラム順序変更 |
| **削除** | ステータスを削除（該当タスクのstatusは空になり、デフォルトステータスに振り分けられる） |
| **Done判定** | そのステータスを「完了」扱いにするかどうか（`doneStatuses`への追加/削除） |
| **デフォルト設定** | 未チェック時/チェック時のデフォルトステータス（`defaultStatus`/`defaultDoneStatus`） |

#### モーダルUIイメージ

```
┌─────────────────────────────────────────────────────┐
│ Status Settings                                  ✕ │
├─────────────────────────────────────────────────────┤
│  ⠿ todo          ☐ Done   [Default: unchecked] [🗑️]│
│  ⠿ in-progress   ☐ Done                        [🗑️]│
│  ⠿ done          ☑ Done   [Default: checked]   [🗑️]│
│                                                     │
│  ⠿ = drag to reorder                               │
└─────────────────────────────────────────────────────┘
```

#### 永続化

フロントマターの以下のフィールドに反映：

```yaml
---
statuses: [todo, in-progress, done]      # 順序も反映
doneStatuses: [done]                     # Done判定
defaultStatus: todo                      # 未チェック時のデフォルト
defaultDoneStatus: done                  # チェック時のデフォルト
---
```

---

### 5. Ctrl+Sによる保存

WebView上でCtrl+S（macOSではCmd+S）を押すと、即座にMarkdownファイルを保存する。現状の自動保存との共存方法は要検討。

> **TODO**: 詳細仕様を検討

---

### 6. Kanbanロック機能

#### 概要

アクティブエディタ切り替え時のKanbanパネルの挙動を制御できるようにする。VSCode標準のMarkdown Previewと同様のハイブリッドアプローチを採用。

#### 仕様

- **デフォルト動作**: アクティブなMarkdownファイルに自動追従（追従モード）
- **ロック機能**: 特定のファイルにKanbanパネルを固定できる（ロックモード）
- **コマンド**:
  - `MD Tasks: Toggle Kanban Locking` - ロック状態の切り替え
  - `MD Tasks: Open Locked Kanban to Side` - 最初からロック状態で開く
- **UI表示**: WebView上にロック状態を示すアイコン（🔒/🔓）を表示

#### ユースケース

- **追従モード**: 複数のMarkdownファイルを切り替えながら、それぞれのKanbanを確認
- **ロックモード**: 他のドキュメントを参照しながら、特定ファイルのKanbanをベースに作業
